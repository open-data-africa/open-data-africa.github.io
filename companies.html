<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Companies & Startups Already Using These Open Datasets</title>
  <style>
    :root { --primary:#0066cc; --green:#0d7b0d; }
    body { font-family: system-ui, sans-serif; background:#f8f9fa; margin:0; color:#333; line-height:1.6; }
    .container { max-width:1300px; margin:0 auto; padding:2rem 1rem; }
    header { text-align:center; margin-bottom:3rem; }
    h1 { font-size:2.8rem; margin:0; color:#1a1a1a; }
    .subtitle { font-size:1.25rem; color:#555; }
    .controls { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; margin-bottom:2.5rem; }
    select, input[type=text] { padding:0.8rem 1rem; border:1px solid #ddd; border-radius:8px; font-size:1rem; min-width:200px; }
    .gallery { display:grid; grid-template-columns:repeat(auto-fill, minmax(380px,1fr)); gap:2rem; }
    .card {
      background:#fff; border-radius:12px; overflow:hidden;
      box-shadow:0 5px 20px rgba(0,0,0,0.1); transition:0.3s all;
    }
    .card:hover { transform:translateY(-10px); box-shadow:0 20px 40px rgba(0,0,0,0.18); }
    .card img {
      width:90px; height:90px; object-fit:contain; background:#f8f8f8;
      padding:15px; border-bottom:1px solid #eee;
    }
    .info { padding:1.4rem; }
    .info h3 a { color:var(--primary); text-decoration:none; font-size:1.35rem; }
    .info h3 a:hover { text-decoration:underline; }
    .meta { font-size:0.95rem; color:#555; margin:0.4rem 0; }
    .domain { color:var(--green); font-weight:bold; }
    .funding {
      display:inline-block; background:#e6f4ea; color:var(--green);
      padding:0.5rem 1rem; border-radius:30px; font-weight:bold; margin:0.7rem 0;
    }
    .tags { margin:1rem 0; }
    .tag {
      display:inline-block; background:#e3f2fd; color:#1565c0;
      padding:0.4rem 0.9rem; border-radius:30px; font-size:0.85rem;
      text-decoration:none; margin-right:0.5rem; margin-bottom:0.5rem;
    }
    .tag:hover { background:#bbdefb; }
    footer { text-align:center; margin-top:5rem; padding:2rem; color:#666; font-size:0.95rem; }
    @media (max-width:768px) { .gallery { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Built With Open Data</h1>
      <p class="subtitle">
        Real African & global startups already using the datasets from this repository<br>
        <strong>More than $560M in total funding raised</strong> (Dec 2025)
      </p>
    </header>

    <div class="controls">
      <select id="domainFilter"><option value="">All Domains</option></select>
      <select id="countryFilter"><option value="">All Countries</option></select>
      <input type="text" id="search" placeholder="Search company, product or dataset…">
    </div>

    <div id="gallery" class="gallery"></div>

    <footer>
      <p>Building something with these datasets? 
         <a href="https://forms.gle/YOUR_FORM_LINK" target="_blank">Submit your project → get featured here</a>
      </p>
      <p>Page auto-updates whenever <code>datasets/Open datasets startups.csv</code> is updated</p>
    </footer>
  </div>

  <script>
    // Your exact CSV path inside the repository
    const CSV_URL = "datasets/Open%20datasets%20startups.csv";

    async function loadAndRender() {
      try {
        const response = await fetch(CSV_URL + "?t=" + Date.now()); // cache-bust
        const text = await response.text();
        const lines = text.trim().split('\n');
        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

        const data = lines.slice(1)
          .map(line => {
            // Properly handle commas inside quoted fields
            const row = [];
            let inQuote = false;
            let field = '';
            for (let char of line + ',') {
              if (char === '"') inQuote = !inQuote;
              else if (char === ',' && !inQuote) { row.push(field.trim()); field = ''; }
              else field += char;
            }
            const obj = {};
            headers.forEach((h, i) => obj[h] = (row[i] || '').replace(/^"|"$/g, ''));
            return obj;
          })
          .filter(r => r.Name); // remove empty lines

        // Populate filters
        const domains = [...new Set(data.map(r => r.Domain || r.domain || '').filter(Boolean))].sort();
        const countries = [...new Set(data.map(r => r.Country || r.country || '').filter(Boolean))].sort();

        const domainSel = document.getElementById('domainFilter');
        const countrySel = document.getElementById('countryFilter');

        domains.forEach(d => { const o = new Option(d, d); domainSel.add(o); });
        countries.forEach(c => { const o = new Option(c, c); countrySel.add(o); });

        // Render function
        function render() {
          const domain = domainSel.value;
          const country = countrySel.value;
          const search = document.getElementById('search').value.toLowerCase();

          const filtered = data.filter(r => {
            if (domain && (r.Domain || r.domain) !== domain) return false;
            if (country && (r.Country || r.country) !== country) return false;
            if (search) {
              const haystack = `${r.Name} ${r.Product} ${r.Description} ${r["Open Datasets Used (Full Clickable Links)"]}`.toLowerCase();
              if (!haystack.includes(search)) return false;
            }
            return true;
          });

          document.getElementById('gallery').innerHTML = filtered.map(r => {
            const datasetLinks = (r["Open Datasets Used (Full Clickable Links)"] || '')
                                  .split(/\s+/)
                                  .filter(Boolean);

            return `
              <div class="card">
                <img src="${r.Logo || 'https://via.placeholder.com/90?text=' + (r.Name?.[0] || '?')}"
                     alt="${r.Name}" onerror="this.src='https://via.placeholder.com/90?text='+(r.Name?.[0]||'?')">
                <div class="info">
                  <h3><a href="${r.Website}" target="_blank">${r.Name}</a></h3>
                  <p class="meta"><strong>${r.Product || r.product}</strong> • ${r.Country || r.country}</p>
                  <p class="meta domain">#${r.Domain || r.domain || 'Other'}</p>
                  ${r.Funding ? `<span class="funding">${r.Funding}</span>` : ''}
                  <div class="tags">
                    ${datasetLinks.map(url => `<a href="${url}" target="_blank" class="tag">dataset</a>`).join('')}
                  </div>
                  <p>${r.Description || r.description}</p>
                </div>
              </div>`;
          }).join('');

          document.querySelector('.subtitle').innerHTML = `
            ${filtered.length} ${filtered.length === 1 ? 'startup' : 'startups'} shown • 
            <strong>More than $560M total funding raised</strong>
          `;
        }

        // Event listeners
        domainSel.onchange = countrySel.onchange = render;
        document.getElementById('search').oninput = render;
        render();

      } catch (e) {
        document.getElementById('gallery').innerHTML = 
          `<p style="text-align:center;color:red;">Could not load the CSV file. Check console for errors.</p>`;
        console.error(e);
      }
    }

    loadAndRender();
  </script>
</body>
</html>
