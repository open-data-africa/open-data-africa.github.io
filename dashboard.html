<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard â€“ Open Data Africa</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    nav {
      background: linear-gradient(to right, #8b0000, #000000);
      padding: 1rem;
    }

    .nav-list {
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 0;
      padding: 0;
      flex-wrap: wrap;
    }

    .nav-list li a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }

    .nav-list li a:hover {
      text-decoration: underline;
    }

    .dashboard-container {
      padding: 2rem;
      max-width: 100%;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: #b30000;
      margin-bottom: 1rem;
    }

    .chart-grid {
      display: flex;
      gap: 3rem;
      overflow-x: auto;
      padding-bottom: 2rem;
      padding-top: 1rem;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      margin-bottom: 3rem;
      height: 600px; /* More vertical room */
    }

    .chart-card {
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      min-width: 900px;
      flex-shrink: 0;
    }

    canvas {
      width: 100% !important;
      height: 500px !important;
    }
  </style>
</head>
<body>

  <!-- Navigation Bar -->
  <nav>
    <ul class="nav-list">
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="datasets.html">Datasets</a></li>
      <li><a href="use-cases.html">Use Cases</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="contribute.html">Contribute</a></li>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- Dashboard Content -->
  <div class="dashboard-container">
    <h1>Interactive Data Dashboard</h1>
    <p style="text-align: center;">Explore trends in dataset contributions across Africa.</p>

    <div class="chart-grid">
      <div class="chart-card"><canvas id="chartCountry"></canvas></div>
      <div class="chart-card"><canvas id="chartDomain"></canvas></div>
      <div class="chart-card"><canvas id="chartType"></canvas></div>
      <div class="chart-card"><canvas id="chartFreshness"></canvas></div>
      <div class="chart-card"><canvas id="chartLicense"></canvas></div>
    </div>
  </div>

  <script>
    function normalize(text) {
      if (!text) return null;
      return text.trim().toLowerCase().replace(/[^a-z0-9 ]/gi, '').replace(/\s+/g, ' ');
    }

    function titleCase(str) {
      return str.replace(/\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substring(1).toLowerCase();
      });
    }

    function sortDataDesc(dataObj) {
      return Object.entries(dataObj)
        .filter(([key]) => key)
        .sort((a, b) => b[1] - a[1])
        .reduce((acc, [key, val]) => {
          acc[key] = val;
          return acc;
        }, {});
    }

    Papa.parse("datasets/catalog.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;

        const countryCount = {};
        const domainCount = {};
        const typeCount = {};
        const licenseCount = {};
        const freshnessCount = {};

        data.forEach(row => {
          const country = titleCase(row.Country?.trim());
          const domain = titleCase(normalize(row.Domain));
          const type = titleCase(normalize(row["Data Type"]));
          const license = titleCase(row.License?.trim());
          const freshness = row["Last Updated"]?.trim();

          if (country) countryCount[country] = (countryCount[country] || 0) + 1;
          if (domain) domainCount[domain] = (domainCount[domain] || 0) + 1;
          if (type) typeCount[type] = (typeCount[type] || 0) + 1;
          if (license) licenseCount[license] = (licenseCount[license] || 0) + 1;
          if (freshness) freshnessCount[freshness] = (freshnessCount[freshness] || 0) + 1;
        });

        const sortedCountry = sortDataDesc(countryCount);
        const sortedDomain = sortDataDesc(domainCount);
        const sortedType = sortDataDesc(typeCount);
        const sortedLicense = sortDataDesc(licenseCount);
        const sortedFreshness = sortDataDesc(freshnessCount);

        const createChart = (id, label, dataObj, chartType = 'bar') => {
          const ctx = document.getElementById(id).getContext('2d');
          new Chart(ctx, {
            type: chartType,
            data: {
              labels: Object.keys(dataObj),
              datasets: [{
                label: label,
                data: Object.values(dataObj),
                backgroundColor: Object.keys(dataObj).map((_, i) =>
                  `hsl(${i * 37 % 360}, 70%, 60%)`
                ),
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: 'bottom'
                },
                tooltip: {
                  mode: 'index',
                  intersect: false
                }
              },
              scales: {
                x: {
                  ticks: {
                    autoSkip: false,
                    maxRotation: 45,
                    minRotation: 45
                  }
                },
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        };

        createChart("chartCountry", "Datasets by Country", sortedCountry);
        createChart("chartDomain", "Datasets by Domain", sortedDomain);
        createChart("chartType", "Data Types", sortedType);
        createChart("chartFreshness", "Dataset Freshness", sortedFreshness, 'line');
        createChart("chartLicense", "License Distribution", sortedLicense, 'doughnut');
      }
    });
  </script>

</body>
</html>
