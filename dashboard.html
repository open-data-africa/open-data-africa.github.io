<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Open Data Africa â€“ Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f8f8;
    }

    nav {
      background: linear-gradient(to right, #8B0000, #000000);
      padding: 10px 0;
    }

    .nav-list {
      display: flex;
      justify-content: center;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-list li {
      margin: 0 15px;
    }

    .nav-list a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
    }

    .dashboard-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
    }

    .chart-box {
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      flex: 1 1 45%;
      max-width: 48%;
      min-width: 300px;
    }

    .chart-box canvas,
    #africaMap {
      width: 100% !important;
      height: 400px !important;
    }

    #africaMap {
      height: 500px;
    }

    @media (max-width: 768px) {
      .chart-box {
        flex: 1 1 100%;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav>
    <ul class="nav-list">
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="datasets.html">Datasets</a></li>
      <li><a href="use-cases.html">Use Cases</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="contribute.html">Contribute</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="dashboard.html" aria-current="page">Dashboard</a></li>
    </ul>
  </nav>

  <main>
    <div class="dashboard-container">
      <!-- African Map Chart -->
      <div class="chart-box">
        <h3>Dataset Distribution Across Africa</h3>
        <div id="africaMap"></div>
      </div>

      <!-- Domain Chart -->
      <div class="chart-box">
        <h3>Most Common Domains</h3>
        <canvas id="domainChart"></canvas>
      </div>

      <!-- Data Type Chart -->
      <div class="chart-box">
        <h3>Prevalent Data Types</h3>
        <canvas id="dataTypeChart"></canvas>
      </div>

      <!-- Dataset Freshness Chart -->
      <div class="chart-box">
        <h3>Dataset Freshness (Last Updated)</h3>
        <canvas id="freshnessChart"></canvas>
      </div>

      <!-- License Chart -->
      <div class="chart-box">
        <h3>Common Licenses</h3>
        <canvas id="licenseChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    Papa.parse("datasets/catalog.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;

        // Data holders
        const domainCount = {};
        const typeCount = {};
        const freshness = {};
        const licenses = {};
        const countryCount = {};

        // Aggregating values
        data.forEach(row => {
          const domain = row["Domain"]?.trim();
          const type = row["Data Type"]?.trim();
          const updated = row["Last Updated"]?.trim();
          const license = row["License"]?.trim();
          const country = row["Country"]?.trim();

          if (domain) domainCount[domain] = (domainCount[domain] || 0) + 1;
          if (type) typeCount[type] = (typeCount[type] || 0) + 1;
          if (updated) freshness[updated] = (freshness[updated] || 0) + 1;
          if (license) licenses[license] = (licenses[license] || 0) + 1;
          if (country) countryCount[country] = (countryCount[country] || 0) + 1;
        });

        // Create charts
        const createChart = (id, labels, values, label, backgroundColors) => {
          new Chart(document.getElementById(id), {
            type: "bar",
            data: {
              labels: labels,
              datasets: [{
                label: label,
                data: values,
                backgroundColor: backgroundColors || 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: "y",
              plugins: {
                legend: { display: true }
              },
              scales: {
                x: {
                  beginAtZero: true
                }
              }
            }
          });
        };

        // Sort and prepare data
        const prepareData = obj => {
          return Object.entries(obj)
            .sort((a, b) => b[1] - a[1])
            .reduce((acc, [key, val]) => {
              acc.labels.push(key);
              acc.values.push(val);
              return acc;
            }, { labels: [], values: [] });
        };

        const domainData = prepareData(domainCount);
        const typeData = prepareData(typeCount);
        const freshnessData = prepareData(freshness);
        const licenseData = prepareData(licenses);

        createChart("domainChart", domainData.labels, domainData.values, "Domains");
        createChart("dataTypeChart", typeData.labels, typeData.values, "Data Types");
        createChart("freshnessChart", freshnessData.labels, freshnessData.values, "Last Updated");
        createChart("licenseChart", licenseData.labels, licenseData.values, "Licenses");

        // Plotly African map
        Plotly.newPlot('africaMap', [{
          type: 'choropleth',
          locationmode: 'country names',
          locations: Object.keys(countryCount),
          z: Object.values(countryCount),
          colorscale: 'Blues',
          colorbar: { title: 'Datasets' },
          text: Object.entries(countryCount).map(([c, v]) => `${c}: ${v}`),
          hoverinfo: 'text'
        }], {
          geo: {
            scope: 'africa',
            showframe: false,
            showcoastlines: true,
            projection: { type: 'natural earth' }
          },
          margin: { t: 0, b: 0 }
        });
      }
    });
  </script>

</body>
</html>
