<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard â€“ Open Data Africa</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 0;
    }

    nav {
      background: linear-gradient(to right, #8b0000, #000000);
      padding: 1rem;
    }

    .nav-list {
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 0;
      padding: 0;
      flex-wrap: wrap;
    }

    .nav-list li a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }

    .nav-list li a:hover {
      text-decoration: underline;
    }

    .dashboard-container {
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: #b30000;
      margin-bottom: 1rem;
    }

    /* Horizontal scroll container */
    .chart-grid {
      display: flex;
      gap: 2rem;
      overflow-x: auto;
      padding-bottom: 1rem;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }

    .chart-card {
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      min-width: 700px; /* wider chart cards */
      flex-shrink: 0; /* prevent shrinking */
    }

    canvas {
      width: 100% !important;
      height: 450px !important; /* bigger height */
    }
  </style>
</head>
<body>

  <!-- Navigation Bar -->
  <nav>
    <ul class="nav-list">
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="datasets.html">Datasets</a></li>
      <li><a href="use-cases.html">Use Cases</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="contribute.html">Contribute</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- Dashboard Content -->
  <div class="dashboard-container">
    <h1>Interactive Data Dashboard</h1>
    <p style="text-align: center;">Visual insights into dataset availability and trends across Africa.</p>

    <div class="chart-grid">
      <div class="chart-card"><canvas id="chartCountry"></canvas></div>
      <div class="chart-card"><canvas id="chartDomain"></canvas></div>
      <div class="chart-card"><canvas id="chartType"></canvas></div>
      <div class="chart-card"><canvas id="chartFreshness"></canvas></div>
      <div class="chart-card"><canvas id="chartLicense"></canvas></div>
    </div>
  </div>

  <script>
    // Helper to sort data descending by count
    function sortDataDesc(dataObj) {
      return Object.entries(dataObj)
        .filter(([key]) => key) // filter out empty keys
        .sort((a, b) => b[1] - a[1])
        .reduce((acc, [key, val]) => {
          acc[key] = val;
          return acc;
        }, {});
    }

    Papa.parse("datasets/catalog.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;

        const countryCount = {};
        const domainCount = {};
        const typeCount = {};
        const licenseCount = {};
        const freshnessCount = {};

        data.forEach(row => {
          if(row.Country) countryCount[row.Country] = (countryCount[row.Country] || 0) + 1;
          if(row.Domain) domainCount[row.Domain] = (domainCount[row.Domain] || 0) + 1;
          if(row["Data Type"]) typeCount[row["Data Type"]] = (typeCount[row["Data Type"]] || 0) + 1;
          if(row.License) licenseCount[row.License] = (licenseCount[row.License] || 0) + 1;
          if(row["Last Updated"]) freshnessCount[row["Last Updated"]] = (freshnessCount[row["Last Updated"]] || 0) + 1;
        });

        // Sort all data descending
        const sortedCountry = sortDataDesc(countryCount);
        const sortedDomain = sortDataDesc(domainCount);
        const sortedType = sortDataDesc(typeCount);
        const sortedLicense = sortDataDesc(licenseCount);
        const sortedFreshness = sortDataDesc(freshnessCount);

        const createChart = (id, label, dataObj, chartType = 'bar') => {
          const ctx = document.getElementById(id).getContext('2d');
          new Chart(ctx, {
            type: chartType,
            data: {
              labels: Object.keys(dataObj),
              datasets: [{
                label: label,
                data: Object.values(dataObj),
                backgroundColor: [
                  '#FF6384', '#36A2EB', '#FFCE56', '#66BB6A', '#BA68C8',
                  '#FFA726', '#8D6E63', '#42A5F5', '#26A69A', '#D4E157'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: 'bottom',
                  labels: {
                    boxWidth: 15,
                    padding: 15
                  }
                },
                tooltip: {
                  mode: 'nearest',
                  intersect: false
                }
              },
              scales: {
                x: {
                  ticks: {
                    autoSkip: false,
                    maxRotation: 45,
                    minRotation: 45
                  }
                },
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        };

        createChart("chartCountry", "Datasets by Country", sortedCountry);
        createChart("chartDomain", "Datasets by Domain", sortedDomain);
        createChart("chartType", "Data Types", sortedType);
        createChart("chartFreshness", "Dataset Freshness", sortedFreshness, 'line');
        createChart("chartLicense", "License Distribution", sortedLicense, 'doughnut');
      }
    });
  </script>

</body>
</html>
