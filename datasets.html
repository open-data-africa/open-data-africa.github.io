<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Open Data Africa ‚Äì Datasets</title>
<link rel="stylesheet" href="style.css" />

<style>
/* General layout */
body {
  font-family: Arial, sans-serif;
}

/* Metrics box */
.metrics {
  text-align: center;
  margin: 2rem auto;
  padding: 1.5rem;
  background: rgba(96,165,250,0.1);
  border-radius: 16px;
  font-size: 1.1rem;
  border: 1px solid rgba(96,165,250,0.3);
  max-width: 700px;
}

.metrics span {
  font-weight: bold;
  color: #60a5fa;
  font-size: 1.4rem;
}

/* Country Table */
.stats-table {
  margin: 2rem auto;
  width: 80%;
  border-collapse: collapse;
}

.stats-table th,
.stats-table td {
  padding: 10px 14px;
  border: 1px solid #ddd;
  text-align: center;
}

.stats-table th {
  background: #e9f2ff;
  color: #333;
  font-weight: bold;
}

.stats-heading {
  text-align: center;
  margin-top: 3rem;
  font-size: 1.4rem;
  font-weight: bold;
}

.button {
  background: #0066ff;
  color: #fff;
  padding: 12px 22px;
  border-radius: 8px;
  text-decoration: none;
}

.button:hover {
  background: #004ed6;
}

.button-outline {
  border: 2px solid #0066ff;
  padding: 10px 20px;
  border-radius: 8px;
  color: #0066ff;
  text-decoration: none;
}

footer {
  text-align: center;
  margin-top: 3rem;
  padding: 1rem 0;
  background: #f5f5f5;
}
</style>
</head>

<body>

<!-- Navigation -->
<nav>
<ul class="nav-list">
<li><a href="index.html">Home</a></li>
<li><a href="about.html">About</a></li>
<li><a href="datasets.html" aria-current="page">Datasets</a></li>
<li><a href="use-cases.html">Use Cases</a></li>
<li><a href="resources.html">Resources</a></li>
<li><a href="contribute.html">Contribute</a></li>
<li><a href="contact.html">Contact</a></li>
</ul>
</nav>

<!-- Hero -->
<section class="hero">
<h1>Access Our Dataset Catalogue</h1>
<p>We catalogue openly licensed datasets relevant to Africa to support AI development across the continent.</p>
</section>

<main class="container">
<p><strong>Explore our full dataset catalogue:</strong></p>

<!-- Download Button -->
<div style="text-align: center; margin: 3rem 0;">
<a href="datasets/Open%20Datasets%20Africa.xlsx"
   class="button"
   download
   id="downloadBtn">
üì• Download Dataset Catalogue (Excel)
</a>
</div>

<!-- Metrics -->
<div class="metrics">
  <p>Total Downloads: <span id="downloadCount">Loading...</span></p>
  <p>Unique Visitors: <span id="visitorCount">Loading...</span></p>
  <p><small>Last updated: <span id="lastUpdate">‚Äî</span></small></p>
</div>

<h3 class="stats-heading">üåç Downloads & Visits by Country</h3>

<table class="stats-table">
<thead>
<tr>
<th>Country</th>
<th>Visits</th>
<th>Downloads</th>
</tr>
</thead>
<tbody id="countryStats"></tbody>
</table>

<p>Want to contribute a dataset to support African AI innovation?</p>
<div style="text-align: center; margin-top: 1rem;">
<a class="button-outline" href="contribute.html">Share Your Dataset</a>
</div>

</main>

<footer>
<p>¬© 2025 Open Data Africa. Powered by AI Made in Africa.</p>
</footer>

<!-- üìä LIVE METRICS SCRIPT -->
<script>
// ------------------------------
// JSONBIN CONFIG ‚Äî REQUIRED
// ------------------------------
const BIN_ID = "693a77f7d0ea881f40216983";
const API_KEY = "$2a$10$OX/sVa0zzJhjrVuZ7Ntdn.vR1lJmoipoZ/2xxFrnc16mCaDHzw5m2";

// ------------------------------
// GEO LOCATION LOOKUP
// ------------------------------
async function getCountry() {
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    return data.country_name || "Unknown";
  } catch {
    return "Unknown";
  }
}

// ------------------------------
// GET STATS FROM JSONBIN
// ------------------------------
async function getStats() {
  const res = await fetch(
    `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,
    { headers: { "X-Master-Key": API_KEY } }
  );
  const json = await res.json();
  return json.record;
}

// ------------------------------
// UPDATE JSONBIN STATS
// ------------------------------
async function updateStats(updated) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify(updated)
  });
}

// ------------------------------
// RECORD VISITOR
// ------------------------------
async function trackVisitor() {
  const country = await getCountry();
  const stats = await getStats();

  stats.visitors += 1;

  if (!stats.countries[country]) {
    stats.countries[country] = { visits: 0, downloads: 0 };
  }
  stats.countries[country].visits += 1;

  await updateStats(stats);
  renderStats(stats);
}

// ------------------------------
// RECORD DOWNLOAD
// ------------------------------
async function trackDownload() {
  const country = await getCountry();
  const stats = await getStats();

  stats.downloads += 1;

  if (!stats.countries[country]) {
    stats.countries[country] = { visits: 0, downloads: 0 };
  }
  stats.countries[country].downloads += 1;

  await updateStats(stats);
  renderStats(stats);
}

// ------------------------------
// DISPLAY STATS ON PAGE
// ------------------------------
function renderStats(stats) {
  document.getElementById("downloadCount").textContent = stats.downloads;
  document.getElementById("visitorCount").textContent = stats.visitors;
  document.getElementById("lastUpdate").textContent = new Date().toLocaleString();

  let rows = "";
  for (const [country, data] of Object.entries(stats.countries)) {
    rows += `
      <tr>
        <td>${country}</td>
        <td>${data.visits}</td>
        <td>${data.downloads}</td>
      </tr>`;
  }

  document.getElementById("countryStats").innerHTML = rows;
}

// ------------------------------
// EVENT: USER CLICKS DOWNLOAD
// ------------------------------
document.getElementById("downloadBtn").addEventListener("click", trackDownload);

// ------------------------------
// INIT ON PAGE LOAD
// ------------------------------
trackVisitor();
</script>

</body>
</html>
