<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>African AI Ecosystem — Network</title>

  <!-- Working Cytoscape + Layout (tested on your site) -->
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/cytoscape-fcose@2.2.0/cytoscape-fcose.js"></script>

  <style>
    :root { --bg:#0f172a; --card:#1e293b; --text:#e2e8f0; --accent:#60a5fa; }
    body { margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text); }
    header { background:linear-gradient(135deg,#1e293b,#0f172a); padding:3rem 1rem; text-align:center; }
    h1 { margin:0; font-size:2.8rem; color:var(--accent); }
    .subtitle { opacity:0.9; font-size:1.2rem; }

    nav.breadcrumb { background:#1e293b; padding:1rem; text-align:center; }
    nav.breadcrumb a { color:var(--accent); text-decoration:none; margin:0 .8rem; }

    #cy { height:75vh; width:100%; border-radius:16px; background:#0f172a; }

    .details {
      max-width:700px; margin:2rem auto; background:var(--card); padding:2rem; border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.4); display:none;
    }
    .org { background:rgba(255,255,255,0.05); padding:1rem; border-radius:12px; margin:1rem 0; }
    .org strong { color:var(--accent); }
  </style>
</head>
<body>

  <header>
    <h1>African AI Ecosystem</h1>
    <p class="subtitle">Interactive Network — Click any bubble to explore</p>
  </header>

  <nav class="breadcrumb">
    <a href="ecosystem-overview.html">Overview</a> •
    <a href="ecosystem-map.html">Map</a> •
    <a href="ecosystem-readiness.html">Readiness</a> •
    <a href="ecosystem-network.html">Network</a> •
    <a href="ecosystem-investor.html">Investor Briefs</a>
  </nav>

  <div id="cy"></div>

  <div class="details" id="details">
    <h2 id="title" style="color:var(--accent);"></h2>
    <div id="orgs"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_PATH = "https://open-data-africa.github.io/datasets/Ecosystem.csv";
    let cy;

    Papa.parse(CSV_PATH, {
      download: true,
      header: true,
      complete: function(res) {
        const data = res.data.filter(r => r.Name && r.Name.trim());

        const countryMap = {};
        data.forEach(org => {
          const c = (org.Country || "Other").trim();
          if (!countryMap[c]) countryMap[c] = { orgs: [], count: 0 };
          countryMap[c].orgs.push(org);
          countryMap[c].count++;
        });

        const elements = Object.entries(countryMap).map(([country, info]) => ({
          data: { 
            id: country, 
            label: `${country}\n${info.count} org${info.count > 1 ? 's' : ''}`,
            orgs: info.orgs
          },
          style: {
            'background-color': info.count > 3 ? '#FF6B6B' : info.count > 1 ? '#60a5fa' : '#96CEB4',
            'width': 60 + info.count * 25,
            'height': 60 + info.count * 25,
            'text-outline-width': 6,
            'text-outline-color': '#0f172a',
            'color': '#e2e8f0',
            'font-size': 18,
            'font-weight': 'bold'
          }
        }));

        if (cy) cy.destroy();

        cy = cytoscape({
          container: document.getElementById('cy'),
          elements: elements,
          style: [{ selector: 'node', style: { 'label': 'data(label)', 'text-valign': 'center', 'text-halign': 'center' } }],
          layout: { name: 'fcose', animationDuration: 1000, fit: true, nodeRepulsion: 8000 },
          userZoomingEnabled: true,
          userPanningEnabled: true
        });

        cy.on('tap', 'node', function(evt) {
          const node = evt.target;
          const orgs = node.data('orgs');
          document.getElementById("title").textContent = node.data('id') + " — " + orgs.length + " organizations";
          document.getElementById("orgs").innerHTML = orgs.map(o => `
            <div class="org">
              <strong>${o.Name}</strong><br>
              <small>${o.Type} • ${o.Domain}</small><br>
              ${o.Website ? `<a href="${o.Website}" target="_blank">Visit Website</a>` : ""}
            </div>
          `).join("");
          document.getElementById("details").style.display = "block";
        });

        cy.on('tap', () => document.getElementById("details").style.display = "none");
      }
    });
  </script>
</body>
</html>
