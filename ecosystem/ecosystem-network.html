<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>African AI Ecosystem — 3D Globe</title>
  <script src="https://unpkg.com/globe.gl"></script>
  <style>
    body { margin:0; background:#000; overflow:hidden; font-family:'Segoe UI',sans-serif; }
    #globe { width:100vw; height:100vh; }
    
    .title {
      position:absolute; top:20px; left:50%; transform:translateX(-50%);
      color:#60a5fa; font-size:3.5rem; font-weight:bold; z-index:10;
      text-shadow:0 0 30px #60a5fa, 0 0 60px #60a5fa;
      letter-spacing:2px;
    }
    
    .controls {
      position:absolute; top:20px; right:20px; background:rgba(0,0,0,0.7);
      padding:1.2rem; border-radius:20px; z-index:10; backdrop-filter:blur(20px);
      border:1px solid rgba(96,165,250,0.3);
    }
    .btn {
      background:linear-gradient(45deg,#60a5fa,#a5b4fc); color:#000;
      border:none; padding:0.9rem 1.8rem; border-radius:15px; cursor:pointer;
      font-weight:bold; font-size:1rem; margin:0.5rem 0; width:100%;
      box-shadow:0 8px 20px rgba(96,165,250,0.4);
    }
    .btn:hover { transform:scale(1.05); }

    .panel {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(15,23,42,0.98); padding:2rem 3rem; border-radius:20px;
      max-width:500px; max-height:80vh; overflow-y:auto;
      color:#e2e8f0; z-index:100; display:none;
      box-shadow:0 20px 60px rgba(0,0,0,0.8);
      border:2px solid #60a5fa;
    }
    .panel h2 { margin:0 0 1.5rem; color:#60a5fa; text-align:center; font-size:2rem; }
    .close { position:absolute; top:15px; right:20px; font-size:2rem; cursor:pointer; color:#60a5fa; }
    .org { background:rgba(255,255,255,0.05); padding:1rem; border-radius:12px; margin:1rem 0; }
    .org strong { color:#60a5fa; }
    .org a { color:#a5b4fc; text-decoration:none; font-weight:bold; }
  </style>
</head>
<body>

  <div class="title">AFRICAN AI ECOSYSTEM</div>

  <div class="controls">
    <button class="btn" id="toggleRotate">Pause Rotation</button>
  </div>

  <div id="globe"></div>

  <!-- POPUP PANEL — shows ALL startups in clicked country -->
  <div class="panel" id="panel">
    <div class="close" onclick="document.getElementById('panel').style.display='none'">×</div>
    <h2 id="countryTitle"></h2>
    <div id="orgList"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_PATH = "https://open-data-africa.github.io/datasets/Ecosystem.csv";

    const globe = Globe()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
      .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
      .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
      .showAtmosphere(true)
      .atmosphereColor('#60a5fa')
      .atmosphereAltitude(0.25)
      (document.getElementById('globe'));

    // Country coordinates
    const coords = {
      "Kenya": [-1.29, 36.82], "Ethiopia": [9.02, 38.75], "Nigeria": [9.08, 7.40],
      "Ghana": [7.95, -1.02], "South Africa": [-30.56, 22.94], "Rwanda": [-1.94, 29.87],
      "Cameroon": [3.85, 11.50], "Tunisia": [36.82, 10.17], "Egypt": [26.82, 30.80],
      "Pan-Africa": [6, 20]
    };

    // Rainbow colors by Type
    const typeColor = {
      "Startup": "#FF6B6B", "Research Lab": "#A55EEA", "Research Institute": "#C56CF0",
      "Platform": "#4ECDC4", "Community": "#96CEB4", "Innovation Hub": "#FECA57",
      "Education Institute": "#FF9FF3", "Program": "#54A0FF", "default": "#60A5FA"
    };

    let allOrgs = [];

    Papa.parse(CSV_PATH, {
      download: true,
      header: true,
      complete: function(res) {
        allOrgs = res.data.filter(r => r.Name && r.Country);

        // Group by country for popup
        const countryGroups = {};
        allOrgs.forEach(org => {
          const c = (org.Country || "Other").trim();
          if (!countryGroups[c]) countryGroups[c] = [];
          countryGroups[c].push(org);
        });

        const points = Object.entries(countryGroups).map(([country, orgs]) => {
          const t = orgs[0].Type || "default";
          return {
            lat: coords[country]?.[0] || 6,
            lng: coords[country]?.[1] || 20,
            size: 0.9,
            color: typeColor[t] || typeColor.default,
            country: country,
            orgs: orgs
          };
        });

        globe
          .pointsData(points)
          .pointAltitude(0.03)
          .pointColor(d => d.color)
          .pointRadius(d => d.size)
          .pointLabel(d => `<b>${d.country}</b><br>${d.orgs.length} organization${d.orgs.length>1?'s':''}`)
          .onPointClick(point => showCountryPanel(point));

        globe.controls().autoRotate = true;
        globe.controls().autoRotateSpeed = 0.6;
      }
    });

    function showCountryPanel(point) {
      const orgs = point.orgs;
      document.getElementById("countryTitle").textContent = `${point.country} — ${orgs.length} Active AI Organizations`;
      document.getElementById("orgList").innerHTML = orgs.map(o => `
        <div class="org">
          <strong>${o.Name}</strong><br>
          <small>${o.Type} • ${o.Domain}</small><br>
          ${o.Website ? `<a href="${o.Website}" target="_blank">Visit Website →</a>` : ""}
        </div>
      `).join("");
      document.getElementById("panel").style.display = "block";
    }

    document.getElementById('toggleRotate').addEventListener('click', function() {
      const rotating = globe.controls().autoRotate;
      globe.controls().autoRotate = !rotating;
      this.textContent = rotating ? "Resume Rotation" : "Pause Rotation";
    });
  </script>
</body>
</html>
