<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>African AI Ecosystem — Network</title>

  <!-- Cytoscape + Required Layouts -->
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/layout-base@2.0.1/layout-base.js"></script>
  <script src="https://unpkg.com/cose-base@2.0.1/cose-base.js"></script>
  <script src="https://unpkg.com/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.js"></script>

  <style>
    :root { --bg:#0f172a; --card:#1e293b; --text:#e2e8f0; --accent:#60a5fa; }
    body { margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text); }
    header { background:linear-gradient(135deg,#1e293b,#0f172a); padding:3rem 1rem; text-align:center; }
    h1 { margin:0; font-size:2.8rem; color:var(--accent); }
    .subtitle { opacity:0.9; font-size:1.2rem; }

    nav.breadcrumb { background:#1e293b; padding:1rem; text-align:center; }
    nav.breadcrumb a { color:var(--accent); text-decoration:none; margin:0 .8rem; }

    .controls { max-width:1400px; margin:2rem auto; padding:0 1rem; display:flex; gap:1rem; flex-wrap:wrap; justify-content:center; }
    .controls input, .controls select { padding:.7rem 1rem; border:none; border-radius:8px; background:#334155; color:white; min-width:220px; }

    #cy { height:75vh; width:100%; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.5); background:#0f172a; }

    .legend { max-width:800px; margin:2rem auto; background:var(--card); padding:1.5rem; border-radius:16px; display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:1rem; }
    .legend-item { display:flex; align-items:center; font-size:0.95rem; }
    .legend-color { width:18px; height:18px; border-radius:50%; margin-right:0.8rem; }

    #details { max-width:700px; margin:2rem auto; background:var(--card); padding:2rem; border-radius:16px; display:none; box-shadow:0 10px 30px rgba(0,0,0,0.4); }
    #details strong { color:var(--accent); font-size:1.5rem; }
    .org-item { background:rgba(255,255,255,0.05); padding:1.2rem; border-radius:12px; margin:1rem 0; }
    .org-item a { color:#60a5fa; text-decoration:none; font-weight:600; }

    @media (max-width:900px) { #cy { height:60vh; } }
  </style>
</head>
<body>

  <header>
    <h1>African AI Ecosystem</h1>
    <p class="subtitle">Interactive Country Clusters — Click any bubble to explore</p>
  </header>

  <nav class="breadcrumb">
    <a href="ecosystem-overview.html">Overview</a> •
    <a href="ecosystem-map.html">Map</a> •
    <a href="ecosystem-readiness.html">Readiness</a> •
    <a href="ecosystem-network.html">Network</a> •
    <a href="ecosystem-investor.html">Investor Briefs</a>
  </nav>

  <div class="controls">
    <input type="text" id="search" placeholder="Search country or organization..." />
    <select id="typeFilter"><option value="">All Types</option></select>
  </div>

  <div id="cy"></div>

  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="background:#FF6B6B;"></div> Startup-heavy</div>
    <div class="legend-item"><div class="legend-color" style="background:#A55EEA;"></div> Research-heavy</div>
    <div class="legend-item"><div class="legend-color" style="background:#4ECDC4;"></div> Platform/Community</div>
    <div class="legend-item"><div class="legend-color" style="background:#96CEB4;"></div> Education/Hub</div>
    <div class="legend-item">Bigger bubble = More organizations</div>
  </div>

  <div id="details">
    <strong id="clusterTitle"></strong>
    <div id="orgList"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_PATH = "https://open-data-africa.github.io/datasets/Ecosystem.csv";
    let cy;
    let allData = [];

    const typeColors = {
      "Startup": "#FF6B6B",
      "Research Lab": "#A55EEA",
      "Research Institute": "#C56CF0",
      "Platform": "#4ECDC4",
      "Community": "#96CEB4",
      "Innovation Hub": "#FECA57",
      "Education Institute": "#96CEB4",
      "Program": "#FF9FF3",
      "default": "#54A0FF"
    };

    // Register the layout (this was missing!)
    cytoscape.use(cytoscapeCoseBilkent);

    Papa.parse(CSV_PATH, {
      download: true,
      header: true,
      complete: function(res) {
        allData = res.data.filter(r => r.Name && r.Name.trim());
        populateTypeFilter();
        buildNetwork();
      }
    });

    function buildNetwork(filterType = "", search = "") {
      const countryMap = {};
      allData.forEach(org => {
        const c = (org.Country || "Unknown").trim();
        if (!countryMap[c]) countryMap[c] = { orgs: [], types: {} };
        if (!filterType || (org.Type || "").trim() === filterType)
          if (!search || JSON.stringify(org).toLowerCase().includes(search.toLowerCase()))
            countryMap[c].orgs.push(org);
        const t = (org.Type || "Unknown").trim();
        countryMap[c].types[t] = (countryMap[c].types[t] || 0) + 1;
      });

      const elements = [];
      Object.entries(countryMap).forEach(([country, data]) => {
        if (data.orgs.length === 0) return;
        const dominantType = Object.entries(data.types).sort((a,b) => b[1]-a[1])[0][0];
        const color = typeColors[dominantType] || typeColors.default;

        elements.push({
          data: {
            id: country,
            label: `${country}\n${data.orgs.length} org${data.orgs.length>1?'s':''}`,
            orgs: data.orgs
          },
          style: {
            'background-color': color,
            'width': 50 + data.orgs.length * 20,
            'height': 50 + data.orgs.length * 20,
            'text-outline-color': '#0f172a',
            'text-outline-width': 6,
            'color': '#e2e8f0',
            'font-size': 18,
            'font-weight': 'bold',
            'text-valign': 'center',
            'text-halign': 'center'
          }
        });
      });

      if (cy) cy.destroy();

      cy = cytoscape({
        container: document.getElementById('cy'),
        elements: elements,
        style: [
          { selector: 'node', style: { 'label': 'data(label)' } }
        ],
        layout: {
          name: 'cose-bilkent',
          animate: true,
          animationDuration: 1000,
          idealEdgeLength: 180,
          nodeRepulsion: 8500,
          gravity: 0.25
        },
        userZoomingEnabled: true,
        userPanningEnabled: true,
        boxSelectionEnabled: false
      });

      cy.on('tap', 'node', function(evt) {
        const node = evt.target;
        const orgs = node.data('orgs') || [];
        document.getElementById("clusterTitle").textContent = `${node.data('id')} — ${orgs.length} organization${orgs.length>1?'s':''}`;
        document.getElementById("orgList").innerHTML = orgs.map(o => `
          <div class="org-item">
            <strong>${o.Name?.trim()}</strong><br>
            <small>${o.Type?.trim()} • ${o.Domain?.trim()}</small>
            ${o.Website ? `<br><a href="${o.Website}" target="_blank">Visit Website</a>` : ""}
          </div>
        `).join("");
        document.getElementById("details").style.display = "block";
        document.getElementById("details").scrollIntoView({ behavior: "smooth" });
      });

      cy.on('tap', function(event) {
        if (event.target === cy) {
          document.getElementById("details").style.display = "none";
        }
      });
    }

    function populateTypeFilter() {
      const types = [...new Set(allData.map(r => (r.Type || "").trim()))].filter(Boolean).sort();
      const select = document.getElementById("typeFilter");
      types.forEach(t => select.add(new Option(t, t)));
    }

    document.getElementById("search").addEventListener("input", () => {
      buildNetwork(document.getElementById("typeFilter").value, document.getElementById("search").value);
    });
    document.getElementById("typeFilter").addEventListener("change", () => {
      buildNetwork(document.getElementById("typeFilter").value, document.getElementById("search").value);
    });
  </script>
</body>
</html>
