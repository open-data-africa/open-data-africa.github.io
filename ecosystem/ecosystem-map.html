<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>African AI Ecosystem — Interactive Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root { --bg:#0f172a; --card:#1e293b; --text:#e2e8f0; --accent:#60a5fa; }
    body { margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text); }
    header { background:linear-gradient(135deg,#1e293b,#0f172a); padding:3rem 1rem; text-align:center; }
    h1 { margin:0; font-size:2.8rem; color:var(--accent); }
    .subtitle { opacity:0.9; font-size:1.2rem; }

    nav.breadcrumb { background:#1e293b; padding:1rem; text-align:center; font-size:1.1rem; }
    nav.breadcrumb a { color:var(--accent); text-decoration:none; margin:0 .8rem; }

    main { max-width:1400px; margin:2rem auto; padding:0 1rem; display:flex; gap:2rem; }
    #map { height:75vh; width:100%; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.5); flex:1; }

    .panel { width:380px; background:var(--card); padding:2rem; border-radius:16px; box-shadow:0 8px 25px rgba(0,0,0,0.3); }
    .panel h3 { margin:0 0 1.5rem; color:var(--accent); font-size:1.6rem; }
    .org-item { background:rgba(255,255,255,0.05); padding:1rem; border-radius:12px; margin:1rem 0; }
    .org-item strong { color:var(--accent); font-size:1.1rem; display:block; }
    .org-item small { opacity:0.8; font-size:0.9rem; }
    .org-item a { color:#60a5fa; text-decoration:none; font-weight:600; }

    #countryName { font-size:1.8rem; font-weight:bold; margin-bottom:1rem; color:var(--accent); }

    .legend { background:rgba(255,255,255,0.05); padding:1rem; border-radius:12px; margin-top:1.5rem; font-size:0.9rem; text-align:center; }
    .legend-item { margin:0.5rem 0; }

    @media (max-width:900px) { main { flex-direction:column; } .panel { width:100%; } #map { height:55vh; } }
  </style>
</head>
<body>

  <header>
    <h1>African AI Ecosystem</h1>
    <p class="subtitle">Click the dots to explore AI activity by country</p>
  </header>

  <nav class="breadcrumb">
    <a href="ecosystem-overview.html">Overview</a> •
    <a href="ecosystem-map.html">Map</a> •
    <a href="ecosystem-readiness.html">Readiness</a> •
    <a href="ecosystem-network.html">Network</a> •
    <a href="ecosystem-investor.html">Investor Briefs</a>
  </nav>

  <main>
    <div id="map"></div>

    <div class="panel">
      <div id="countryName">Click a dot</div>
      <div id="countryStats"></div>
      <h3 style="margin-top:2rem;">Organizations</h3>
      <div id="orgList"><p style="opacity:0.7; text-align:center;">Select a country to view details</p></div>

      <div class="legend">
        <div class="legend-item">Small dot = AI activity in this country</div>
        <div class="legend-item">Click dot → View full profile</div>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_PATH = "https://open-data-africa.github.io/datasets/Ecosystem.csv";
    const map = L.map('map').setView([6, 20], 3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    let ecosystem = [];

    Papa.parse(CSV_PATH, {
      download: true,
      header: true,
      complete: function(res) {
        ecosystem = res.data.filter(r => r.Name && r.Name.trim());
        plotDots();
      }
    });

    function plotDots() {
      const countryData = {};
      ecosystem.forEach(org => {
        const c = (org.Country || "").trim();
        if (!c) return;
        if (!countryData[c]) countryData[c] = { count: 0, orgs: [] };
        countryData[c].count++;
        countryData[c].orgs.push(org);
      });

      Object.entries(countryData).forEach(([country, data]) => {
        const coords = getCoords(country);
        if (!coords) return;

        const size = data.count > 3 ? 26 : data.count > 1 ? 22 : 18;

        const marker = L.circleMarker(coords, {
          radius: size,
          fillColor: "#60a5fa",
          color: "#fff",
          weight: 3,
          opacity: 1,
          fillOpacity: 0.8
        }).addTo(map);

        marker.bindTooltip(`<strong>${country}</strong><br>${data.count} organization${data.count > 1 ? 's' : ''}`, {
          permanent: false,
          direction: "top"
        });

        marker.on({
          mouseover: () => marker.setStyle({ fillColor: "#a5b4fc", weight: 5 }),
          mouseout: () => marker.setStyle({ fillColor: "#60a5fa", weight: 3 }),
          click: () => showCountry(country, data.orgs, marker)
        });
      });

      map.fitBounds([[ -35, -20 ], [ 37, 55 ]]);
    }

    function showCountry(country, orgs, marker) {
      document.getElementById("countryName").textContent = country;
      document.getElementById("countryStats").innerHTML = `<p><strong>${orgs.length}</strong> active AI organization${orgs.length > 1 ? 's' : ''}</p>`;

      document.getElementById("orgList").innerHTML = orgs.map(o => `
        <div class="org-item">
          <strong>${o.Name?.trim()}</strong>
          <small>${o.Type?.trim()} • ${o.Domain?.trim()}</small>
          ${o.Website ? `<br><a href="${o.Website}" target="_blank">Visit Website</a>` : ""}
        </div>
      `).join("");

      // Zoom to the dot
      map.setView(marker.getLatLng(), 6);
    }

    // Country → center coordinates
    function getCoords(country) {
      const map = {
        "Kenya": [-1.2921, 36.8219],
        "Ethiopia": [8.9806, 38.7578],
        "Nigeria": [9.0765, 7.3986],
        "Ghana": [7.9465, -1.0232],
        "South Africa": [-30.5595, 22.9375],
        "Rwanda": [-1.9403, 29.8739],
        "Uganda": [1.3733, 32.2903],
        "Egypt": [26.8206, 30.8025],
        "Morocco": [31.7917, -7.0926],
        "Pan-Africa": [6, 20]
      };
      return map[country] || null;
    }
  </script>
</body>
</html>
