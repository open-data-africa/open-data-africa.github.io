<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Africa Dataset Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<!-- Styles -->
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #f7f7f7; }

  #map {
    width: 100%;
    height: 90vh;
  }

  /* Modal */
  .modal-bg {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.55);
    z-index: 5000;
    justify-content: center;
    align-items: center;
  }

  .modal-box {
    background: white;
    width: 90%;
    max-width: 600px;
    padding: 1.5rem;
    border-radius: 10px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-box h2 {
    margin-top: 0;
    color: #222;
  }

  .dataset-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e4e4e4;
  }

  .close-btn {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    background: #8f0c24;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
</style>
</head>

<body>

<h2 style="text-align:center; padding: 1rem; color:#333;">
  üåç Africa Datasets Interactive Map
</h2>

<div id="map"></div>

<!-- Modal -->
<div id="modal-bg" class="modal-bg">
  <div class="modal-box">
    <h2 id="modal-title"></h2>
    <div id="modal-content"></div>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
/* --------------------------------------------------------------
   1. Built-in Africa GeoJSON  (Option A)
-------------------------------------------------------------- */
const africaGeoJSON = {
  "type": "FeatureCollection",
  "features": [
    {"type":"Feature","properties":{"name":"Ethiopia"},"geometry":{"type":"Polygon","coordinates":[[[42.3,14.1],[47.8,14.0],[49.0,11.5],[48.0,8.0],[44.0,4.8],[39.5,3.5],[34.0,4.5],[33.0,8.0],[36.0,12.0],[42.3,14.1]]]}},
    {"type":"Feature","properties":{"name":"Kenya"},"geometry":{"type":"Polygon","coordinates":[[[33.9,4.4],[41.8,4.4],[41.9,-1.0],[34.5,-1.2],[33.9,4.4]]]}},
    {"type":"Feature","properties":{"name":"Uganda"},"geometry":{"type":"Polygon","coordinates":[[[29.6,4.2],[35.0,4.2],[34.6,-1.5],[29.6,-1.0],[29.6,4.2]]]}},
    {"type":"Feature","properties":{"name":"Tanzania"},"geometry":{"type":"Polygon","coordinates":[[[29.3,-1.0],[40.0,-1.0],[40.0,-11.8],[29.3,-11.8],[29.3,-1.0]]]}},
    {"type":"Feature","properties":{"name":"Nigeria"},"geometry":{"type":"Polygon","coordinates":[[[2.7,13.9],[14.5,13.9],[14.5,4.2],[2.7,4.2],[2.7,13.9]]]}},
    {"type":"Feature","properties":{"name":"Ghana"},"geometry":{"type":"Polygon","coordinates":[[[-3.3,11.2],[-0.1,11.2],[-0.1,4.7],[-3.3,4.7],[-3.3,11.2]]]}},
    {"type":"Feature","properties":{"name":"South Africa"},"geometry":{"type":"Polygon","coordinates":[[[16.0,-22.0],[32.9,-22.0],[32.9,-34.9],[16.0,-34.9],[16.0,-22.0]]]}},
    {"type":"Feature","properties":{"name":"Egypt"},"geometry":{"type":"Polygon","coordinates":[[[25.0,31.7],[36.8,31.7],[36.8,21.7],[25.0,21.7],[25.0,31.7]]]}},
    {"type":"Feature","properties":{"name":"Morocco"},"geometry":{"type":"Polygon","coordinates":[[[-13.0,35.9],[-1.0,35.9],[-1.0,27.7],[-13.0,27.7],[-13.0,35.9]]]}},
    {"type":"Feature","properties":{"name":"Senegal"},"geometry":{"type":"Polygon","coordinates":[[[-17.6,16.6],[-11.2,16.6],[-11.2,12.3],[-17.6,12.3],[-17.6,16.6]]]}},
    {"type":"Feature","properties":{"name":"Rwanda"},"geometry":{"type":"Polygon","coordinates":[[[29.0,-1.0],[30.9,-1.0],[30.9,-2.8],[29.0,-2.8],[29.0,-1.0]]]}},
    {"type":"Feature","properties":{"name":"Burundi"},"geometry":{"type":"Polygon","coordinates":[[[29.0,-2.8],[30.8,-2.8],[30.8,-4.5],[29.0,-4.5],[29.0,-2.8]]]}}
  ]
};

/* --------------------------------------------------------------
   2. Load CSV (datasets/catalog.csv)
-------------------------------------------------------------- */
let catalogData = [];

Papa.parse("datasets/catalog.csv", {
  download: true,
  header: true,
  complete: (results) => { catalogData = results.data; }
});

/* --------------------------------------------------------------
   3. Leaflet Map
-------------------------------------------------------------- */
const map = L.map("map").setView([8, 21], 3.9);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 7,
}).addTo(map);

/* --------------------------------------------------------------
   4. Country Click ‚Üí Show Modal
-------------------------------------------------------------- */
function onCountryClick(e) {
  const countryName = e.target.feature.properties.name.trim().toLowerCase();

  // Filter datasets where Country column matches
  const countryDatasets = catalogData.filter(row =>
    (row["Country"] || "").trim().toLowerCase() === countryName
  );

  // Set modal title
  document.getElementById("modal-title").textContent =
    countryName.charAt(0).toUpperCase() + countryName.slice(1);

  // Dataset content
  const container = document.getElementById("modal-content");
  container.innerHTML = "";

  if (countryDatasets.length === 0) {
    container.innerHTML = `<p>No datasets available for this country.</p>`;
  } else {
    countryDatasets.forEach(set => {
      const div = document.createElement("div");
      div.className = "dataset-item";
      div.innerHTML = `
        <strong>${set["Dataset Name"] || "Untitled Dataset"}</strong><br>
        <em>${set["Domain"] || "Unknown Domain"}</em>
      `;
      container.appendChild(div);
    });
  }

  document.getElementById("modal-bg").style.display = "flex";
}

function closeModal() {
  document.getElementById("modal-bg").style.display = "none";
}

/* --------------------------------------------------------------
   5. Style + Add GeoJSON Layer
-------------------------------------------------------------- */
L.geoJSON(africaGeoJSON, {
  style: {
    color: "#8f0c24",
    weight: 1.2,
    fillColor: "#e5a4b4",
    fillOpacity: 0.7
  },
  onEachFeature: function (feature, layer) {
    layer.on({
      click: onCountryClick,
      mouseover: (e) => { e.target.setStyle({ fillOpacity: 0.9 }); },
      mouseout: (e) => { e.target.setStyle({ fillOpacity: 0.7 }); }
    });
  }
}).addTo(map);
</script>

</body>
</html>
