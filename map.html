<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Africa Dataset Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>

<style>
  body { margin: 0; font-family: Arial, sans-serif; background:#f7f7f7; }
  #map { width: 100%; height: 95vh; }

  .leaflet-popup-content {
    font-size: 14px;
    line-height: 1.4rem;
  }
  .dataset-title { font-weight: bold; margin-bottom: 4px; }
</style>
</head>

<body>

<h2 style="text-align:center; padding: 1rem; color:#8f0c24; font-weight:700;">
  üåç Africa Datasets ‚Äì Click a Country Dot
</h2>

<div id="map"></div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
/* --------------------------------------------------------------
   1. Coordinates for all African countries
   (covers every possible entry from your catalog.csv)
-------------------------------------------------------------- */
const africaCoords = {
  "algeria": [28.0, 1.6],
  "angola": [-11.2, 17.8],
  "benin": [9.5, 2.3],
  "botswana": [-22.3, 24.7],
  "burkina faso": [12.3, -1.6],
  "burundi": [-3.4, 29.9],
  "cabo verde": [16.0, -24.0],
  "cameroon": [5.9, 12.7],
  "central african republic": [6.6, 20.9],
  "chad": [15.3, 18.7],
  "comoros": [-11.6, 43.3],
  "congo": [-0.2, 15.3],
  "democratic republic of the congo": [-2.9, 23.7],
  "djibouti": [11.8, 42.6],
  "egypt": [26.8, 30.8],
  "equatorial guinea": [1.6, 10.5],
  "eritrea": [15.1, 39.8],
  "eswatini": [-26.4, 31.5],
  "ethiopia": [9.1, 40.5],
  "gabon": [-0.8, 11.6],
  "gambia": [13.5, -15.3],
  "ghana": [7.9, -1.0],
  "guinea": [10.4, -10.9],
  "guinea-bissau": [11.8, -15.2],
  "ivory coast": [7.6, -5.5],
  "kenya": [-0.1, 37.9],
  "lesotho": [-29.6, 28.2],
  "liberia": [6.4, -9.3],
  "libya": [27.0, 18.0],
  "madagascar": [-18.8, 46.8],
  "malawi": [-13.3, 34.3],
  "mali": [17.5, -3.9],
  "mauritania": [20.2, -10.3],
  "mauritius": [-20.3, 57.5],
  "morocco": [31.8, -7.1],
  "mozambique": [-18.1, 35.5],
  "namibia": [-22.6, 17.1],
  "niger": [17.6, 8.1],
  "nigeria": [9.1, 8.7],
  "rwanda": [-1.9, 30.1],
  "sao tome and principe": [0.3, 6.6],
  "senegal": [14.5, -14.5],
  "seychelles": [-4.6, 55.4],
  "sierra leone": [8.5, -11.8],
  "somalia": [5.1, 46.2],
  "south africa": [-30.6, 22.9],
  "south sudan": [7.3, 30.4],
  "sudan": [15.6, 30.2],
  "tanzania": [-6.3, 34.8],
  "togo": [8.6, 1.0],
  "tunisia": [34.0, 9.5],
  "uganda": [1.3, 32.3],
  "zambia": [-13.1, 27.8],
  "zimbabwe": [-19.0, 29.2]
};

/* --------------------------------------------------------------
   2. Initialize Map
-------------------------------------------------------------- */
const map = L.map("map").setView([5, 20], 3.8);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 7
}).addTo(map);

/* --------------------------------------------------------------
   3. Load catalog.csv and place dots
-------------------------------------------------------------- */
Papa.parse("datasets/catalog.csv", {
  download: true,
  header: true,
  complete: function (results) {
    const data = results.data;

    // Get unique countries
    let uniqueCountries = new Set();
    data.forEach(row => {
      if (row.Country && row.Country.trim() !== "") {
        uniqueCountries.add(row.Country.trim().toLowerCase());
      }
    });

    uniqueCountries.forEach(country => {
      if (!africaCoords[country]) return; // Skip unknown

      let [lat, lon] = africaCoords[country];

      // Filter datasets for this country
      const datasets = data.filter(r =>
        (r.Country || "").trim().toLowerCase() === country
      );

      // Popup Content
      let html = `<h3 style='margin:0 0 5px; color:#8f0c24;'>${country.toUpperCase()}</h3>`;

      if (datasets.length === 0) {
        html += `<p>No datasets available.</p>`;
      } else {
        html += `<p><strong>${datasets.length}</strong> datasets:</p>`;
        datasets.forEach(ds => {
          html += `
            <div class="dataset-title">${ds["Dataset Name"] || "Unnamed Dataset"}</div>
            <small>${ds["Domain"] || ""}</small><br><br>
          `;
        });
      }

      // Add dot marker
      L.circleMarker([lat, lon], {
        radius: 8,
        fillColor: "#8f0c24",
        color: "#8f0c24",
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(html)
      .addTo(map);
    });
  }
});
</script>

</body>
</html>
